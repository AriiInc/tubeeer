From 350a77693f9c2e20c6a02a49ef7a422792b01af3 Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Wed, 26 Apr 2017 15:12:55 -0400
Subject: [PATCH] CVE-2017-8347

The ReadEXRImage function in exr.c allows attackers to cause a denial of service (memory leak) via a crafted file.

bug: https://github.com/ImageMagick/ImageMagick/issues/441
origin: https://github.com/ImageMagick/ImageMagick/commit/babb3b6c992bef4098ba40353c16d3beba5920a4
bug-debian: https://bugs.debian.org/862577
---
 coders/exr.c | 2 ++
 1 file changed, 2 insertions(+)

Index: imagemagick-6.7.7.10/coders/exr.c
===================================================================
--- imagemagick-6.7.7.10.orig/coders/exr.c	2017-05-26 09:16:40.632748399 -0400
+++ imagemagick-6.7.7.10/coders/exr.c	2017-05-26 09:16:40.628748348 -0400
@@ -194,6 +194,7 @@ static Image *ReadEXRImage(const ImageIn
       if (LocaleCompare(image_info->filename,read_info->filename) != 0)
         (void) RelinquishUniqueFileResource(read_info->filename);
       read_info=DestroyImageInfo(read_info);
+      image=DestroyImageList(image);
       return((Image *) NULL);
     }
   hdr_info=ImfInputHeader(file);
@@ -224,6 +225,7 @@ static Image *ReadEXRImage(const ImageIn
       if (LocaleCompare(image_info->filename,read_info->filename) != 0)
         (void) RelinquishUniqueFileResource(read_info->filename);
       read_info=DestroyImageInfo(read_info);
+      image=DestroyImageList(image);
       ThrowReaderException(ResourceLimitError,"MemoryAllocationFailed");
     }
   for (y=0; y < (ssize_t) image->rows; y++)
