From ac9d53d0228986d3de7c6d67bb1adb6cd9fb99e3 Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Wed, 26 Apr 2017 16:37:58 -0400
Subject: [PATCH] CVE-2017-8348

The ReadMATImage function in mat.c allows attackers to cause a denial of service (memory leak) via a crafted file.

bug: https://github.com/ImageMagick/ImageMagick/issues/445
origin: https://github.com/ImageMagick/ImageMagick/commit/0c60e6ead120fe2036ceb87662de91d52a4ec4aa
bug-debian: https://bugs.debian.org/862578
---
 coders/mat.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: imagemagick-6.7.7.10/coders/mat.c
===================================================================
--- imagemagick-6.7.7.10.orig/coders/mat.c	2017-05-26 09:16:44.824801793 -0400
+++ imagemagick-6.7.7.10/coders/mat.c	2017-05-26 09:16:44.824801793 -0400
@@ -948,7 +948,6 @@ ImportQuantumPixelsFailed:
   }
       }
     } while(z-- >= 2);
-    quantum_info=DestroyQuantumInfo(quantum_info);
 ExitLoop:
 
 
@@ -1058,6 +1057,7 @@ done_reading:
   clone_info=DestroyImageInfo(clone_info);
 
   RelinquishMagickMemory(BImgBuff);
+  quantum_info=DestroyQuantumInfo(quantum_info);
   CloseBlob(image);
 
 
