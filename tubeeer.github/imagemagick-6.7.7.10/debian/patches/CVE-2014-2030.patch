Description: fix denial of service via jpeg images with specially-
 crafted restart markers
Origin: upstream, http://trac.imagemagick.org/changeset/13736
Bug-RedHat: https://bugzilla.redhat.com/show_bug.cgi?id=1064098
Bug-Debian: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=740250

Index: imagemagick-6.7.7.10/coders/psd.c
===================================================================
--- imagemagick-6.7.7.10.orig/coders/psd.c	2014-03-06 11:12:27.873354853 -0500
+++ imagemagick-6.7.7.10/coders/psd.c	2014-03-06 11:12:42.113355385 -0500
@@ -2105,9 +2105,6 @@
   StringInfo
     *bim_profile;
 
-  unsigned char
-    layer_name[4];
-
   /*
     Open image file.
   */
@@ -2365,12 +2362,15 @@
         property=(const char *) GetImageProperty(next_image,"label");
         if (property == (const char *) NULL)
           {
+            char
+              layer_name[MaxTextExtent];
+
             (void) WriteBlobMSBLong(image,16);
             (void) WriteBlobMSBLong(image,0);
             (void) WriteBlobMSBLong(image,0);
-            (void) FormatLocaleString((char *) layer_name,MaxTextExtent,
-              "L%06ld",(long) layer_count++);
-            WritePascalString( image, (char*)layer_name, 4 );
+            (void) FormatLocaleString(layer_name,MaxTextExtent,"L%06ld",(long)
+              layer_count++);
+            WritePascalString(image,layer_name,4);
           }
         else
           {
